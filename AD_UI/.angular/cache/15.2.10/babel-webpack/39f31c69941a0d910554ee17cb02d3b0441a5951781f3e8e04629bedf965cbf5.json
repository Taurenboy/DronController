{"ast":null,"code":"var _asyncToGenerator = require(\"C:/Users/ingev/Documents/Desarrollo/Luna/DronController/AD_UI/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nconst {\n  format\n} = require('util');\nconst {\n  KafkaJSLockTimeout\n} = require('../errors');\nconst PRIVATE = {\n  LOCKED: Symbol('private:Lock:locked'),\n  TIMEOUT: Symbol('private:Lock:timeout'),\n  WAITING: Symbol('private:Lock:waiting'),\n  TIMEOUT_ERROR_MESSAGE: Symbol('private:Lock:timeoutErrorMessage')\n};\nconst TIMEOUT_MESSAGE = 'Timeout while acquiring lock (%d waiting locks)';\nmodule.exports = class Lock {\n  constructor({\n    timeout,\n    description = null\n  } = {}) {\n    if (typeof timeout !== 'number') {\n      throw new TypeError(`'timeout' is not a number, received '${typeof timeout}'`);\n    }\n    this[PRIVATE.LOCKED] = false;\n    this[PRIVATE.TIMEOUT] = timeout;\n    this[PRIVATE.WAITING] = new Set();\n    this[PRIVATE.TIMEOUT_ERROR_MESSAGE] = () => {\n      const timeoutMessage = format(TIMEOUT_MESSAGE, this[PRIVATE.WAITING].size);\n      return description ? `${timeoutMessage}: \"${description}\"` : timeoutMessage;\n    };\n  }\n  acquire() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      return new Promise((resolve, reject) => {\n        if (!_this[PRIVATE.LOCKED]) {\n          _this[PRIVATE.LOCKED] = true;\n          return resolve();\n        }\n        let timeoutId = null;\n        const tryToAcquire = /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* () {\n            if (!_this[PRIVATE.LOCKED]) {\n              _this[PRIVATE.LOCKED] = true;\n              clearTimeout(timeoutId);\n              _this[PRIVATE.WAITING].delete(tryToAcquire);\n              return resolve();\n            }\n          });\n          return function tryToAcquire() {\n            return _ref.apply(this, arguments);\n          };\n        }();\n        _this[PRIVATE.WAITING].add(tryToAcquire);\n        timeoutId = setTimeout(() => {\n          // The message should contain the number of waiters _including_ this one\n          const error = new KafkaJSLockTimeout(_this[PRIVATE.TIMEOUT_ERROR_MESSAGE]());\n          _this[PRIVATE.WAITING].delete(tryToAcquire);\n          reject(error);\n        }, _this[PRIVATE.TIMEOUT]);\n      });\n    })();\n  }\n  release() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2[PRIVATE.LOCKED] = false;\n      const waitingLock = _this2[PRIVATE.WAITING].values().next().value;\n      if (waitingLock) {\n        return waitingLock();\n      }\n    })();\n  }\n};","map":{"version":3,"names":["format","require","KafkaJSLockTimeout","PRIVATE","LOCKED","Symbol","TIMEOUT","WAITING","TIMEOUT_ERROR_MESSAGE","TIMEOUT_MESSAGE","module","exports","Lock","constructor","timeout","description","TypeError","Set","timeoutMessage","size","acquire","Promise","resolve","reject","timeoutId","tryToAcquire","clearTimeout","delete","add","setTimeout","error","release","waitingLock","values","next","value"],"sources":["C:/Users/ingev/Documents/Desarrollo/Luna/DronController/AD_UI/node_modules/kafkajs/src/utils/lock.js"],"sourcesContent":["const { format } = require('util')\nconst { KafkaJSLockTimeout } = require('../errors')\n\nconst PRIVATE = {\n  LOCKED: Symbol('private:Lock:locked'),\n  TIMEOUT: Symbol('private:Lock:timeout'),\n  WAITING: Symbol('private:Lock:waiting'),\n  TIMEOUT_ERROR_MESSAGE: Symbol('private:Lock:timeoutErrorMessage'),\n}\n\nconst TIMEOUT_MESSAGE = 'Timeout while acquiring lock (%d waiting locks)'\n\nmodule.exports = class Lock {\n  constructor({ timeout, description = null } = {}) {\n    if (typeof timeout !== 'number') {\n      throw new TypeError(`'timeout' is not a number, received '${typeof timeout}'`)\n    }\n\n    this[PRIVATE.LOCKED] = false\n    this[PRIVATE.TIMEOUT] = timeout\n    this[PRIVATE.WAITING] = new Set()\n    this[PRIVATE.TIMEOUT_ERROR_MESSAGE] = () => {\n      const timeoutMessage = format(TIMEOUT_MESSAGE, this[PRIVATE.WAITING].size)\n      return description ? `${timeoutMessage}: \"${description}\"` : timeoutMessage\n    }\n  }\n\n  async acquire() {\n    return new Promise((resolve, reject) => {\n      if (!this[PRIVATE.LOCKED]) {\n        this[PRIVATE.LOCKED] = true\n        return resolve()\n      }\n\n      let timeoutId = null\n      const tryToAcquire = async () => {\n        if (!this[PRIVATE.LOCKED]) {\n          this[PRIVATE.LOCKED] = true\n          clearTimeout(timeoutId)\n          this[PRIVATE.WAITING].delete(tryToAcquire)\n          return resolve()\n        }\n      }\n\n      this[PRIVATE.WAITING].add(tryToAcquire)\n      timeoutId = setTimeout(() => {\n        // The message should contain the number of waiters _including_ this one\n        const error = new KafkaJSLockTimeout(this[PRIVATE.TIMEOUT_ERROR_MESSAGE]())\n        this[PRIVATE.WAITING].delete(tryToAcquire)\n        reject(error)\n      }, this[PRIVATE.TIMEOUT])\n    })\n  }\n\n  async release() {\n    this[PRIVATE.LOCKED] = false\n    const waitingLock = this[PRIVATE.WAITING].values().next().value\n\n    if (waitingLock) {\n      return waitingLock()\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}