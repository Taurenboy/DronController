{"ast":null,"code":"var _asyncToGenerator = require(\"C:/Users/ingev/Documents/Desarrollo/Luna/DronController/AD_UI/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nconst apiKeys = require('../protocol/requests/apiKeys');\nconst Connection = require('./connection');\nmodule.exports = class ConnectionPool {\n  /**\n   * @param {ConstructorParameters<typeof Connection>[0]} options\n   */\n  constructor(options) {\n    this.logger = options.logger.namespace('ConnectionPool');\n    this.connectionTimeout = options.connectionTimeout;\n    this.host = options.host;\n    this.port = options.port;\n    this.rack = options.rack;\n    this.ssl = options.ssl;\n    this.sasl = options.sasl;\n    this.clientId = options.clientId;\n    this.socketFactory = options.socketFactory;\n    this.pool = new Array(2).fill().map(() => new Connection(options));\n  }\n  isConnected() {\n    return this.pool.some(c => c.isConnected());\n  }\n  isAuthenticated() {\n    return this.pool.some(c => c.isAuthenticated());\n  }\n  setSupportAuthenticationProtocol(isSupported) {\n    this.map(c => c.setSupportAuthenticationProtocol(isSupported));\n  }\n  setVersions(versions) {\n    this.map(c => c.setVersions(versions));\n  }\n  map(callback) {\n    return this.pool.map(c => callback(c));\n  }\n  send(protocolRequest) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const connection = yield _this.getConnectionByRequest(protocolRequest);\n      return connection.send(protocolRequest);\n    })();\n  }\n  getConnectionByRequest({\n    request: {\n      apiKey\n    }\n  }) {\n    const index = {\n      [apiKeys.Fetch]: 1\n    }[apiKey] || 0;\n    return this.getConnection(index);\n  }\n  getConnection(index = 0) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const connection = _this2.pool[index];\n      if (!connection.isConnected()) {\n        yield connection.connect();\n      }\n      return connection;\n    })();\n  }\n  destroy() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      yield Promise.all(_this3.map(c => c.disconnect()));\n    })();\n  }\n};","map":{"version":3,"names":["apiKeys","require","Connection","module","exports","ConnectionPool","constructor","options","logger","namespace","connectionTimeout","host","port","rack","ssl","sasl","clientId","socketFactory","pool","Array","fill","map","isConnected","some","c","isAuthenticated","setSupportAuthenticationProtocol","isSupported","setVersions","versions","callback","send","protocolRequest","connection","getConnectionByRequest","request","apiKey","index","Fetch","getConnection","connect","destroy","Promise","all","disconnect"],"sources":["C:/Users/ingev/Documents/Desarrollo/Luna/DronController/AD_UI/node_modules/kafkajs/src/network/connectionPool.js"],"sourcesContent":["const apiKeys = require('../protocol/requests/apiKeys')\nconst Connection = require('./connection')\n\nmodule.exports = class ConnectionPool {\n  /**\n   * @param {ConstructorParameters<typeof Connection>[0]} options\n   */\n  constructor(options) {\n    this.logger = options.logger.namespace('ConnectionPool')\n    this.connectionTimeout = options.connectionTimeout\n    this.host = options.host\n    this.port = options.port\n    this.rack = options.rack\n    this.ssl = options.ssl\n    this.sasl = options.sasl\n    this.clientId = options.clientId\n    this.socketFactory = options.socketFactory\n\n    this.pool = new Array(2).fill().map(() => new Connection(options))\n  }\n\n  isConnected() {\n    return this.pool.some(c => c.isConnected())\n  }\n\n  isAuthenticated() {\n    return this.pool.some(c => c.isAuthenticated())\n  }\n\n  setSupportAuthenticationProtocol(isSupported) {\n    this.map(c => c.setSupportAuthenticationProtocol(isSupported))\n  }\n\n  setVersions(versions) {\n    this.map(c => c.setVersions(versions))\n  }\n\n  map(callback) {\n    return this.pool.map(c => callback(c))\n  }\n\n  async send(protocolRequest) {\n    const connection = await this.getConnectionByRequest(protocolRequest)\n    return connection.send(protocolRequest)\n  }\n\n  getConnectionByRequest({ request: { apiKey } }) {\n    const index = { [apiKeys.Fetch]: 1 }[apiKey] || 0\n    return this.getConnection(index)\n  }\n\n  async getConnection(index = 0) {\n    const connection = this.pool[index]\n\n    if (!connection.isConnected()) {\n      await connection.connect()\n    }\n\n    return connection\n  }\n\n  async destroy() {\n    await Promise.all(this.map(c => c.disconnect()))\n  }\n}\n"],"mappings":";AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,8BAA8B,CAAC;AACvD,MAAMC,UAAU,GAAGD,OAAO,CAAC,cAAc,CAAC;AAE1CE,MAAM,CAACC,OAAO,GAAG,MAAMC,cAAc,CAAC;EACpC;AACF;AACA;EACEC,WAAW,CAACC,OAAO,EAAE;IACnB,IAAI,CAACC,MAAM,GAAGD,OAAO,CAACC,MAAM,CAACC,SAAS,CAAC,gBAAgB,CAAC;IACxD,IAAI,CAACC,iBAAiB,GAAGH,OAAO,CAACG,iBAAiB;IAClD,IAAI,CAACC,IAAI,GAAGJ,OAAO,CAACI,IAAI;IACxB,IAAI,CAACC,IAAI,GAAGL,OAAO,CAACK,IAAI;IACxB,IAAI,CAACC,IAAI,GAAGN,OAAO,CAACM,IAAI;IACxB,IAAI,CAACC,GAAG,GAAGP,OAAO,CAACO,GAAG;IACtB,IAAI,CAACC,IAAI,GAAGR,OAAO,CAACQ,IAAI;IACxB,IAAI,CAACC,QAAQ,GAAGT,OAAO,CAACS,QAAQ;IAChC,IAAI,CAACC,aAAa,GAAGV,OAAO,CAACU,aAAa;IAE1C,IAAI,CAACC,IAAI,GAAG,IAAIC,KAAK,CAAC,CAAC,CAAC,CAACC,IAAI,EAAE,CAACC,GAAG,CAAC,MAAM,IAAInB,UAAU,CAACK,OAAO,CAAC,CAAC;EACpE;EAEAe,WAAW,GAAG;IACZ,OAAO,IAAI,CAACJ,IAAI,CAACK,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACF,WAAW,EAAE,CAAC;EAC7C;EAEAG,eAAe,GAAG;IAChB,OAAO,IAAI,CAACP,IAAI,CAACK,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,eAAe,EAAE,CAAC;EACjD;EAEAC,gCAAgC,CAACC,WAAW,EAAE;IAC5C,IAAI,CAACN,GAAG,CAACG,CAAC,IAAIA,CAAC,CAACE,gCAAgC,CAACC,WAAW,CAAC,CAAC;EAChE;EAEAC,WAAW,CAACC,QAAQ,EAAE;IACpB,IAAI,CAACR,GAAG,CAACG,CAAC,IAAIA,CAAC,CAACI,WAAW,CAACC,QAAQ,CAAC,CAAC;EACxC;EAEAR,GAAG,CAACS,QAAQ,EAAE;IACZ,OAAO,IAAI,CAACZ,IAAI,CAACG,GAAG,CAACG,CAAC,IAAIM,QAAQ,CAACN,CAAC,CAAC,CAAC;EACxC;EAEMO,IAAI,CAACC,eAAe,EAAE;IAAA;IAAA;MAC1B,MAAMC,UAAU,SAAS,KAAI,CAACC,sBAAsB,CAACF,eAAe,CAAC;MACrE,OAAOC,UAAU,CAACF,IAAI,CAACC,eAAe,CAAC;IAAA;EACzC;EAEAE,sBAAsB,CAAC;IAAEC,OAAO,EAAE;MAAEC;IAAO;EAAE,CAAC,EAAE;IAC9C,MAAMC,KAAK,GAAG;MAAE,CAACrC,OAAO,CAACsC,KAAK,GAAG;IAAE,CAAC,CAACF,MAAM,CAAC,IAAI,CAAC;IACjD,OAAO,IAAI,CAACG,aAAa,CAACF,KAAK,CAAC;EAClC;EAEME,aAAa,CAACF,KAAK,GAAG,CAAC,EAAE;IAAA;IAAA;MAC7B,MAAMJ,UAAU,GAAG,MAAI,CAACf,IAAI,CAACmB,KAAK,CAAC;MAEnC,IAAI,CAACJ,UAAU,CAACX,WAAW,EAAE,EAAE;QAC7B,MAAMW,UAAU,CAACO,OAAO,EAAE;MAC5B;MAEA,OAAOP,UAAU;IAAA;EACnB;EAEMQ,OAAO,GAAG;IAAA;IAAA;MACd,MAAMC,OAAO,CAACC,GAAG,CAAC,MAAI,CAACtB,GAAG,CAACG,CAAC,IAAIA,CAAC,CAACoB,UAAU,EAAE,CAAC,CAAC;IAAA;EAClD;AACF,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}